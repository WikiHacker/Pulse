---
import Icon from './Icon.astro';
---

<div class="mb-4 sm:mb-6 flex flex-wrap items-center justify-between gap-3 sm:gap-4">
  <div>
    <p id="all-systems-title" class="text-lg sm:text-xl md:text-2xl font-semibold text-[#262626] dark:text-[#f5f5f5]">All Services</p>
    <p id="all-systems-desc" class="text-xs sm:text-sm text-[#a3a3a3] dark:text-[#a3a3a3] text-[#404040]">Updated in real time. Click on a service to view information.</p>
  </div>
  <div class="flex items-center gap-2 sm:gap-3 w-full sm:w-auto">
    <div class="relative flex-1 sm:flex-none">
      <span class="pointer-events-none absolute left-2 sm:left-3 top-1/2 -translate-y-1/2 text-[#737373] dark:text-[#737373] text-[#a3a3a3] flex items-center">
        <Icon name="search" size={14} class="w-3.5 h-3.5 sm:w-[14px] sm:h-[14px]" />
      </span>
      <input
        id="system-filter-input"
        type="text"
        class="w-full sm:w-48 md:w-56 rounded-xl border border-[#404040]/50 dark:border-[#404040]/50 border-[#a3a3a3]/50 bg-[#222] dark:bg-[#222] bg-white py-1.5 sm:py-2 pl-7 sm:pl-9 pr-2 sm:pr-3 text-xs sm:text-sm text-[#262626] dark:text-[#d4d4d4] placeholder-[#737373] dark:placeholder-[#737373] placeholder-[#a3a3a3] outline-none transition-colors focus:border-[#525252] dark:focus:border-[#525252] focus:border-[#737373] focus:bg-[#282828] dark:focus:bg-[#282828] focus:bg-[#f5f5f5] leading-normal"
        placeholder="Filter..."
        data-placeholder-en="Filter..."
        data-placeholder-zh="筛选..."
      />
    </div>
    <div class="relative" id="columns-dropdown-container">
      <button id="columns-btn" class="flex items-center gap-1 sm:gap-1.5 rounded-xl border border-[#404040]/50 dark:border-[#404040]/50 border-[#a3a3a3]/50 bg-[#222] dark:bg-[#222] bg-white px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm font-semibold text-[#262626] dark:text-[#d4d4d4] transition-colors hover:border-[#525252] dark:hover:border-[#525252] hover:border-[#737373] hover:bg-[#282828] dark:hover:bg-[#282828] hover:bg-[#f5f5f5]">
        <span id="columns-btn-text">Columns</span>
        <Icon name="chevron-down" size={12} class="w-3 h-3 sm:w-3.5 sm:h-3.5 text-[#737373] dark:text-[#737373] text-[#525252]" />
      </button>
      <div id="columns-dropdown" class="absolute right-0 top-full mt-2 hidden w-48 rounded-lg border border-[#404040]/50 dark:border-[#404040]/50 border-[#a3a3a3]/50 bg-[#1c1c1c] dark:bg-[#1c1c1c] bg-white shadow-2xl z-10">
        <div class="p-2">
          <div id="sort-by-label" class="mb-1 px-2 py-1 text-xs font-semibold text-[#737373] dark:text-[#737373] text-[#525252] uppercase">Sort by</div>
          <button class="sort-option w-full flex items-center justify-between rounded px-3 py-2 text-sm text-[#262626] dark:text-[#d4d4d4] transition-colors hover:bg-[#282828] dark:hover:bg-[#282828] hover:bg-[#f5f5f5]" data-sort="name">
            <span data-translate="name">Name</span>
            <span class="sort-indicator hidden text-blue-400">
              <Icon name="check" size={14} class="w-3.5 h-3.5 sm:w-[14px] sm:h-[14px]" />
            </span>
          </button>
          <button class="sort-option w-full flex items-center justify-between rounded px-3 py-2 text-sm text-[#262626] dark:text-[#d4d4d4] transition-colors hover:bg-[#282828] dark:hover:bg-[#282828] hover:bg-[#f5f5f5]" data-sort="time">
            <span data-translate="time">Time</span>
            <span class="sort-indicator hidden text-blue-400">
              <Icon name="check" size={14} class="w-3.5 h-3.5 sm:w-[14px] sm:h-[14px]" />
            </span>
          </button>
          <button class="sort-option w-full flex items-center justify-between rounded px-3 py-2 text-sm text-[#262626] dark:text-[#d4d4d4] transition-colors hover:bg-[#282828] dark:hover:bg-[#282828] hover:bg-[#f5f5f5]" data-sort="os">
            <span data-translate="os">OS</span>
            <span class="sort-indicator hidden text-blue-400">
              <Icon name="check" size={14} class="w-3.5 h-3.5 sm:w-[14px] sm:h-[14px]" />
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  import { initI18n, t } from '../utils/i18n.ts';
  
  // Initialize i18n
  initI18n();
  
  // Translation map for this component
  const translations = {
    'allSystems': { en: 'All Services', zh: '所有服务' },
    'updatedInRealTime': { en: 'Updated in real time. Click on a service to view information.', zh: '实时更新。点击服务查看详细信息。' },
    'filter': { en: 'Filter...', zh: '筛选...' },
    'columns': { en: 'Columns', zh: '列' },
    'sortBy': { en: 'Sort by', zh: '排序方式' },
    'name': { en: 'Name', zh: '名称' },
    'time': { en: 'Time', zh: '运行时间' },
    'os': { en: 'OS', zh: '系统' },
  };
  
  function updateTranslations() {
    const lang = localStorage.getItem('preferred-language') || 'en';
    
    // Update title
    const title = document.getElementById('all-systems-title');
    if (title) title.textContent = translations.allSystems[lang];
    
    // Update description
    const desc = document.getElementById('all-systems-desc');
    if (desc) desc.textContent = translations.updatedInRealTime[lang];
    
    // Update filter placeholder
    const filterInput = document.getElementById('system-filter-input');
    if (filterInput) {
      filterInput.placeholder = translations.filter[lang];
    }
    
    // Update columns button
    const columnsBtn = document.getElementById('columns-btn-text');
    if (columnsBtn) columnsBtn.textContent = translations.columns[lang];
    
    // Update sort by label
    const sortByLabel = document.getElementById('sort-by-label');
    if (sortByLabel) sortByLabel.textContent = translations.sortBy[lang];
    
    // Update sort options
    document.querySelectorAll('[data-translate]').forEach(el => {
      const key = el.getAttribute('data-translate');
      if (key && translations[key]) {
        el.textContent = translations[key][lang];
      }
    });
  }
  
  // Listen for language changes
  window.addEventListener('languagechange', updateTranslations);
  window.addEventListener('translate', updateTranslations);
  
  // Initial translation
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', updateTranslations);
  } else {
    updateTranslations();
  }
</script>
